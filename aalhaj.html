<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>بنك أسئلة معمارية الحاسوب - د. منال العريقي</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --success-color: #2ecc71;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        @media (max-width: 480px) {

    body {
        font-size: 14px;
    }

    .container {
        padding: 10px;
    }

    header {
        padding: 15px 0;
    }

    .logo h1 {
        font-size: 1.3rem;
    }

    .logo p {
        font-size: 0.8rem;
    }

    .controls {
        flex-direction: column;
        gap: 10px;
    }

    .btn {
        width: 100%;
        justify-content: center;
        padding: 10px;
        font-size: 0.9rem;
    }

    /* كرت السؤال */
    .question-card {
        padding: 15px;
    }

    .question-header {
        flex-direction: column;
        align-items: center;
        text-align: center;
    }

    .question-number {
        margin-bottom: 10px;
    }

    .question-text {
        margin: 0;
    }

    .question-text-ar {
        font-size: 1rem;
    }

    .question-text-en {
        font-size: 0.9rem;
        border: none;
        padding: 0;
        margin-top: 8px;
    }

    .answer-indicator {
        margin-top: 10px;
    }

    /* الأزرار داخل السؤال */
    .question-actions {
        flex-direction: column;
    }

    .action-btn {
        width: 100%;
        justify-content: center;
    }

    /* الإحصائيات */
    .stat-card p {
        font-size: 1.4rem;
    }

    footer {
        padding: 15px 0;
    }

    .footer-content p {
        font-size: 0.85rem;
    }
}
button, select {
    min-height: 44px;
}

        /* الهيدر */
        header {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 25px 0;
            border-radius: 0 0 var(--border-radius) var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 30px;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo i {
            font-size: 2.5rem;
        }

        .logo h1 {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .logo p {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-top: 5px;
        }

        .controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        /* أزرار التحكم */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--secondary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }

        .btn-outline {
            background-color: transparent;
            color: white;
            border: 2px solid white;
        }

        .btn-outline:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .language-switcher {
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 50px;
            padding: 5px;
            display: flex;
        }

        .lang-btn {
            padding: 8px 16px;
            border: none;
            background: transparent;
            color: white;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
        }

        .lang-btn.active {
            background-color: white;
            color: var(--primary-color);
        }

        /* التصفية */
        .filter-section {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: var(--box-shadow);
        }

        .filter-section h3 {
            margin-bottom: 15px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-options {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            min-width: 200px;
            flex-grow: 1;
        }

        .filter-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #555;
        }

        select {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            background-color: white;
            font-size: 1rem;
        }

        .view-mode {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        .view-btn {
            padding: 8px 16px;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
        }

        .view-btn.active {
            background-color: var(--secondary-color);
            color: white;
            border-color: var(--secondary-color);
        }

        .view-btn:hover {
            background-color: #e9ecef;
        }

        .view-btn.active:hover {
            background-color: #2980b9;
        }

        .stats {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .stat-card {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: var(--border-radius);
            flex-grow: 1;
            text-align: center;
            border-left: 4px solid var(--secondary-color);
        }

        .stat-card h4 {
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .stat-card p {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--secondary-color);
        }

        /* عرض الأسئلة */
        .questions-container {
            margin-bottom: 40px;
        }

        .exam-section {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--box-shadow);
        }

        .exam-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }

        .exam-title h2 {
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .exam-meta {
            display: flex;
            gap: 15px;
            color: #666;
            font-size: 0.9rem;
        }

        .question-type {
            margin-top: 25px;
            margin-bottom: 15px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        /* بطاقة السؤال */
        .question-card {
            background-color: #f8f9fa;
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #ddd;
            transition: var(--transition);
        }

        .question-card.true-false {
            border-left-color: var(--success-color);
        }

        .question-card.essay {
            border-left-color: var(--secondary-color);
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .question-number {
            background-color: var(--primary-color);
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            flex-shrink: 0;
        }

        .question-text {
            flex-grow: 1;
            margin: 0 15px;
        }

        .question-text-ar {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .question-text-en {
            font-size: 1rem;
            color: #555;
            font-style: italic;
            padding-right: 15px;
            border-right: 3px solid #eee;
        }

        body[dir="ltr"] .question-text-en {
            padding-right: 0;
            padding-left: 15px;
            border-right: none;
            border-left: 3px solid #eee;
        }

        .answer-indicator {
            padding: 6px 12px;
            border-radius: 50px;
            font-weight: 700;
            font-size: 0.9rem;
            flex-shrink: 0;
            white-space: nowrap;
        }

        .answer-true {
            background-color: #d4edda;
            color: #155724;
        }

        .answer-false {
            background-color: #f8d7da;
            color: #721c24;
        }

        .answer-essay {
            background-color: #d1ecf1;
            color: #0c5460;
        }

        .question-body {
            margin-bottom: 15px;
        }

        .answer-section {
            background-color: white;
            padding: 15px;
            border-radius: var(--border-radius);
            border: 1px solid #eee;
            margin-bottom: 10px;
        }

        .answer-section h5 {
            color: var(--primary-color);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .answer-ar, .answer-en {
            margin-bottom: 8px;
            line-height: 1.6;
        }

        .answer-ar {
            font-weight: 600;
            color: var(--primary-color);
        }

        .answer-en {
            color: #555;
            font-style: italic;
            padding-right: 15px;
            border-right: 3px solid #eee;
        }

        body[dir="ltr"] .answer-en {
            padding-right: 0;
            padding-left: 15px;
            border-right: none;
            border-left: 3px solid #eee;
        }

        /* تصحيح الخطأ */
        .correction-section {
            background-color: #fff3cd;
            border-radius: var(--border-radius);
            padding: 15px;
            margin-top: 15px;
            border: 1px solid #ffeaa7;
            display: none;
        }

        .correction-section.show {
            display: block;
        }

        .correction-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            color: #856404;
            font-weight: 600;
        }

        .correction-content {
            color: #856404;
            line-height: 1.6;
        }

        .correction-ar, .correction-en {
            margin-bottom: 8px;
        }

        .correction-ar {
            font-weight: 600;
        }

        .correction-en {
            font-style: italic;
            padding-right: 15px;
            border-right: 3px solid #ffd670;
        }

        body[dir="ltr"] .correction-en {
            padding-right: 0;
            padding-left: 15px;
            border-right: none;
            border-left: 3px solid #ffd670;
        }

        /* المرجع */
        .reference-section {
            background-color: #e9f7fe;
            border-radius: var(--border-radius);
            padding: 12px 15px;
            margin-top: 15px;
            font-size: 0.9rem;
            color: #0c5460;
            display: none;
        }

        .reference-section.show {
            display: flex;
        }

        .reference-section i {
            color: var(--secondary-color);
            flex-shrink: 0;
        }

        .reference-content {
            margin-right: 10px;
        }

        body[dir="ltr"] .reference-content {
            margin-right: 0;
            margin-left: 10px;
        }

        /* نقاط المقال */
        .essay-points {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 15px;
            margin-top: 15px;
            border: 1px solid #eee;
        }

        .essay-points h5 {
            margin-bottom: 10px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .points-ar, .points-en {
            margin-bottom: 15px;
        }

        .points-ar h6, .points-en h6 {
            color: var(--primary-color);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .points-ar ul, .points-en ul {
            padding-right: 20px;
        }

        body[dir="ltr"] .points-ar ul,
        body[dir="ltr"] .points-en ul {
            padding-right: 0;
            padding-left: 20px;
        }

        .points-ar li, .points-en li {
            margin-bottom: 8px;
            line-height: 1.6;
        }

        .points-en {
            font-style: italic;
            color: #555;
        }

        /* أزرار التفاعل */
        .question-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .action-btn {
            padding: 8px 15px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: var(--transition);
        }

        .action-btn.correction-btn {
            background-color: #fff3cd;
            color: #856404;
        }

        .action-btn.correction-btn:hover {
            background-color: #ffeaa7;
        }

        .action-btn.reference-btn {
            background-color: #d1ecf1;
            color: #0c5460;
        }

        .action-btn.reference-btn:hover {
            background-color: #bee5eb;
        }

        /* الفوتر */
        footer {
            background-color: var(--primary-color);
            color: white;
            padding: 25px 0;
            text-align: center;
            border-radius: var(--border-radius) var(--border-radius) 0 0;
            margin-top: 40px;
        }

        .footer-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .footer-content p {
            opacity: 0.9;
            max-width: 600px;
        }

        /* التجاوبية */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            
            .controls {
                width: 100%;
                justify-content: center;
            }
            
            .filter-options {
                flex-direction: column;
            }
            
            .question-header {
                flex-direction: column;
                gap: 15px;
            }
            
            .question-text {
                margin: 0;
                text-align: center;
            }
            
            .exam-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .stats {
                flex-direction: column;
            }
            
            .question-actions {
                flex-wrap: wrap;
            }
        }

        /* تأثيرات إضافية */
        .highlight {
            background-color: rgba(52, 152, 219, 0.1);
            padding: 3px 5px;
            border-radius: 3px;
        }

        .no-results {
            text-align: center;
            padding: 40px 20px;
            color: #666;
            font-size: 1.2rem;
        }

        .no-results i {
            font-size: 3rem;
            color: #ddd;
            margin-bottom: 15px;
        }

        .loading {
            text-align: center;
            padding: 40px 20px;
            color: #666;
            font-size: 1.2rem;
        }

        .loading i {
            font-size: 3rem;
            color: var(--secondary-color);
            margin-bottom: 15px;
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background-color: #f8d7da;
            color: #721c24;
            padding: 20px;
            border-radius: var(--border-radius);
            margin: 20px 0;
            text-align: center;
            border: 1px solid #f5c6cb;
        }

        .error-message i {
            font-size: 2rem;
            margin-bottom: 10px;
        }
    </style>
</head>
<body dir="rtl">
    <!-- الهيدر -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-laptop-code"></i>
                    <div>
                        <h1>بنك أسئلة معمارية الحاسوب</h1>
                        <p>نماذج اختبار نصفي - د. منال العريقي - CS25</p>
                        <p>تم بواسطة المهندس: عبدالملك حسان الحاج</p>
                        <p>علوم الحاسوب - مستوى ثاني</p>
                    </div>
                </div>
                <div class="controls">
                    <div class="language-switcher">
                        <button class="lang-btn active" id="arabicBtn" onclick="switchLanguage('ar')">
                            <i class="fas fa-language"></i> العربية
                        </button>
                        <button class="lang-btn" id="englishBtn" onclick="switchLanguage('en')">
                            <i class="fas fa-language"></i> English
                        </button>
                    </div>
                    <button class="btn btn-outline" onclick="toggleAllCorrections()">
                        <i class="fas fa-lightbulb"></i>
                        <span id="toggleCorrectionsText">عرض جميع التصحيحات</span>
                    </button>
                    <button class="btn btn-outline" onclick="toggleAllReferences()">
                        <i class="fas fa-book"></i>
                        <span id="toggleReferencesText">عرض جميع المراجع</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- المحتوى الرئيسي -->
    <div class="container">
        <!-- قسم التصفية -->
        <section class="filter-section">
            <h3>
                <i class="fas fa-filter"></i>
                <span id="filterTitle">تصفية الأسئلة</span>
            </h3>
            <div class="filter-options">
                <div class="filter-group">
                    <label id="questionTypeLabel">نوع السؤال</label>
                    <select id="questionTypeFilter">
                        <option value="all">جميع الأسئلة</option>
                        <option value="true_false">صح/خطأ</option>
                        <option value="essay">مقالي</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label id="sourceLabel">المصدر</label>
                    <select id="sourceFilter">
                        <option value="all">جميع المصادر</option>
                        <option value="exam">امتحانات نموذجية</option>
                        <option value="chapter">بنك أسئلة الفصول</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label id="examChapterLabel">الامتحان / الفصل</label>
                    <select id="examChapterFilter">
                        <option value="all">الجميع</option>
                        <!-- سيتم ملء هذا القائمة ديناميكيًا -->
                    </select>
                </div>
            </div>
            
            <div class="view-mode">
                <span id="viewModeLabel">طريقة العرض:</span>
                <button class="view-btn active" onclick="setViewMode('both')">
                    <i class="fas fa-columns"></i>
                    <span id="viewBothText">العربية والإنجليزية</span>
                </button>
                <button class="view-btn" onclick="setViewMode('arabic')">
                    <i class="fas fa-font"></i>
                    <span id="viewArabicText">العربية فقط</span>
                </button>
                <button class="view-btn" onclick="setViewMode('english')">
                    <i class="fas fa-font"></i>
                    <span id="viewEnglishText">الإنجليزية فقط</span>
                </button>
            </div>
            
            <div class="stats">
                <div class="stat-card">
                    <h4 id="totalQuestionsLabel">إجمالي الأسئلة</h4>
                    <p id="totalQuestions">0</p>
                </div>
                <div class="stat-card">
                    <h4 id="tfQuestionsLabel">أسئلة صح/خطأ</h4>
                    <p id="tfQuestions">0</p>
                </div>
                <div class="stat-card">
                    <h4 id="essayQuestionsLabel">أسئلة مقالية</h4>
                    <p id="essayQuestions">0</p>
                </div>
                <div class="stat-card">
                    <h4 id="correctionQuestionsLabel">أسئلة تحتوي على تصحيح</h4>
                    <p id="correctionQuestions">0</p>
                </div>
            </div>
        </section>

        <!-- عرض الأسئلة -->
        <section class="questions-container" id="questionsContainer">
            <!-- سيتم ملء الأسئلة هنا ديناميكيًا -->
            <div class="loading" id="loadingIndicator">
                <i class="fas fa-spinner"></i>
                <p id="loadingText">جارٍ تحميل الأسئلة...</p>
            </div>
        </section>
    </div>

    <!-- الفوتر -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <i class="fas fa-graduation-cap fa-2x"></i>
                <p id="footerText">بنك أسئلة لمادة معمارية الحاسوب - تم إنشاؤه بناءً على الشبترات من CH1 الى CH5 لـ د. منال العريقي</p>
                <p id="copyrightText">جميع الحقوق محفوظة للمهندس عبدالملك حسان الحاج &copy; <span id="currentYear"></span></p>
            </div>
        </div>
    </footer>

    <script>
        // حالة التطبيق
        let currentLanguage = 'ar';
        let currentViewMode = 'both'; // 'both', 'arabic', 'english'
        let allQuestions = [];
        let filteredQuestions = [];
        let showAllCorrections = false;
        let showAllReferences = false;
        let questionsData = null;

        // تهيئة التطبيق عند تحميل الصفحة
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        // تهيئة التطبيق
        function initializeApp() {
            // تعيين سنة حقوق النشر
            const currentYear = new Date().getFullYear();
            document.getElementById('currentYear').textContent = currentYear;
            
            // إعداد مستمعي الأحداث
            setupEventListeners();
            
            // تحميل بيانات الأسئلة
            loadQuestionsData();
        }

        // إعداد مستمعي الأحداث
        function setupEventListeners() {
            // تصفية حسب نوع السؤال
            document.getElementById('questionTypeFilter').addEventListener('change', filterQuestions);
            
            // تصفية حسب المصدر
            document.getElementById('sourceFilter').addEventListener('change', function() {
                updateExamChapterFilter();
                filterQuestions();
            });
            
            // تصفية حسب الامتحان/الفصل
            document.getElementById('examChapterFilter').addEventListener('change', filterQuestions);
        }

        // تحميل بيانات الأسئلة من ملف JSON
        async function loadQuestionsData() {
            try {
                // تحميل ملف JSON من نفس المجلد
                const response = await fetch('questions.json');
                
                if (!response.ok) {
                    throw new Error(`فشل في تحميل ملف الأسئلة: ${response.status} ${response.statusText}`);
                }
                
                questionsData = await response.json();
                
                // إخفاء مؤشر التحميل
                document.getElementById('loadingIndicator').style.display = 'none';
                
                // معالجة البيانات وعرضها
                processQuestionsData();
                
            } catch (error) {
                console.error('خطأ في تحميل البيانات:', error);
                showError('فشل في تحميل ملف الأسئلة. يرجى التأكد من وجود ملف questions.json في نفس المجلد.');
            }
        }

        // عرض رسالة خطأ
        function showError(message) {
            const container = document.getElementById('questionsContainer');
            container.innerHTML = `
                <div class="error-message">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3>حدث خطأ</h3>
                    <p>${message}</p>
                    <button class="btn btn-primary" onclick="location.reload()">
                        <i class="fas fa-redo"></i> إعادة تحميل الصفحة
                    </button>
                </div>
            `;
        }

        // معالجة بيانات الأسئلة
        function processQuestionsData() {
            allQuestions = [];
            
            // تحميل أسئلة الامتحانات النموذجية
            if (questionsData.midterm_models_solutions && questionsData.midterm_models_solutions.exams) {
                questionsData.midterm_models_solutions.exams.forEach(exam => {
                    // أسئلة صح/خطأ
                    if (exam.true_false) {
                        exam.true_false.forEach(question => {
                            allQuestions.push({
                                id: `exam-${exam.exam_id}-tf-${question.no}`,
                                type: 'true_false',
                                source: 'exam',
                                examId: exam.exam_id,
                                examNameAr: exam.exam_name_ar,
                                examNameEn: exam.exam_name_en,
                                chapterId: 'exam',
                                chapterTitleAr: 'امتحانات نموذجية',
                                chapterTitleEn: 'Model Exams',
                                number: question.no,
                                questionAr: question.statement_ar,
                                questionEn: question.statement_en,
                                answerAr: question.answer_ar,
                                answerEn: question.answer_en,
                                answerBoolean: question.answer_boolean,
                                correctionAr: question.correction_ar || '',
                                correctionEn: question.correction_en || '',
                                support: question.support || [],
                                hasCorrection: !!(question.correction_ar || question.correction_en)
                            });
                        });
                    }
                    
                    // أسئلة مقالية
                    if (exam.essay) {
                        exam.essay.forEach(question => {
                            allQuestions.push({
                                id: `exam-${exam.exam_id}-essay-${question.no}`,
                                type: 'essay',
                                source: 'exam',
                                examId: exam.exam_id,
                                examNameAr: exam.exam_name_ar,
                                examNameEn: exam.exam_name_en,
                                chapterId: 'exam',
                                chapterTitleAr: 'امتحانات نموذجية',
                                chapterTitleEn: 'Model Exams',
                                number: question.no,
                                questionAr: question.question_ar,
                                questionEn: question.question_en,
                                answerPointsAr: question.answer_points_ar || [],
                                answerPointsEn: question.answer_points_en || [],
                                support: question.support || [],
                                hasCorrection: false
                            });
                        });
                    }
                });
            }
            
            // تحميل أسئلة بنك الأسئلة من الفصول
            if (questionsData.generated_question_bank_from_chapters && questionsData.generated_question_bank_from_chapters.chapters) {
                questionsData.generated_question_bank_from_chapters.chapters.forEach(chapter => {
                    // أسئلة صح/خطأ
                    if (chapter.true_false) {
                        chapter.true_false.forEach(question => {
                            allQuestions.push({
                                id: question.id || `chapter-${chapter.chapter_id}-tf-${question.id || Math.random()}`,
                                type: 'true_false',
                                source: 'chapter',
                                examId: `chapter-${chapter.chapter_id}`,
                                examNameAr: chapter.chapter_title_ar,
                                examNameEn: chapter.chapter_title_en,
                                chapterId: chapter.chapter_id,
                                chapterTitleAr: chapter.chapter_title_ar,
                                chapterTitleEn: chapter.chapter_title_en,
                                number: question.id ? question.id.replace('Ch1_TF_', '') : '?',
                                questionAr: question.statement_ar,
                                questionEn: question.statement_en,
                                answerAr: question.answer_ar,
                                answerEn: question.answer_en,
                                answerBoolean: question.answer_boolean,
                                correctionAr: question.correction_ar || '',
                                correctionEn: question.correction_en || '',
                                support: question.source ? [question.source] : [],
                                hasCorrection: !!(question.correction_ar || question.correction_en)
                            });
                        });
                    }
                    
                    // أسئلة مقالية
                    if (chapter.essay) {
                        chapter.essay.forEach(question => {
                            allQuestions.push({
                                id: question.id || `chapter-${chapter.chapter_id}-essay-${question.id || Math.random()}`,
                                type: 'essay',
                                source: 'chapter',
                                examId: `chapter-${chapter.chapter_id}`,
                                examNameAr: chapter.chapter_title_ar,
                                examNameEn: chapter.chapter_title_en,
                                chapterId: chapter.chapter_id,
                                chapterTitleAr: chapter.chapter_title_ar,
                                chapterTitleEn: chapter.chapter_title_en,
                                number: question.id ? question.id.replace('Ch1_ES_', '') : '?',
                                questionAr: question.question_ar,
                                questionEn: question.question_en,
                                answerPointsAr: question.answer_points_ar || [],
                                answerPointsEn: question.answer_points_en || [],
                                support: question.source ? [question.source] : [],
                                hasCorrection: false
                            });
                        });
                    }
                });
            }
            
            // تعيين الأسئلة المفلترة
            filteredQuestions = [...allQuestions];
            
            // تحديث قوائم التصفية
            updateExamChapterFilter();
            
            // تحديث الإحصائيات
            updateStats();
            
            // عرض الأسئلة
            displayQuestions();
        }

        // تحديث قائمة التصفية حسب الامتحان/الفصل
        function updateExamChapterFilter() {
            const sourceFilter = document.getElementById('sourceFilter').value;
            const examChapterFilter = document.getElementById('examChapterFilter');
            
            // مسح القائمة الحالية
            examChapterFilter.innerHTML = '<option value="all">الجميع</option>';
            
            // الحصول على قائمة فريدة من الامتحانات/الفصول بناءً على المصدر المحدد
            let items = [];
            
            if (sourceFilter === 'all') {
                items = [...new Set(allQuestions.map(q => q.examId))];
            } else {
                items = [...new Set(allQuestions
                    .filter(q => q.source === sourceFilter)
                    .map(q => q.examId))];
            }
            
            // إضافة خيارات جديدة
            items.forEach(itemId => {
                const item = allQuestions.find(q => q.examId === itemId);
                if (item) {
                    const option = document.createElement('option');
                    option.value = itemId;
                    option.textContent = currentLanguage === 'ar' ? item.examNameAr : item.examNameEn;
                    examChapterFilter.appendChild(option);
                }
            });
        }

        // تصفية الأسئلة
        function filterQuestions() {
            const questionType = document.getElementById('questionTypeFilter').value;
            const sourceFilter = document.getElementById('sourceFilter').value;
            const examChapterFilter = document.getElementById('examChapterFilter').value;
            
            filteredQuestions = allQuestions.filter(question => {
                // تصفية حسب نوع السؤال
                if (questionType !== 'all' && question.type !== questionType) {
                    return false;
                }
                
                // تصفية حسب المصدر
                if (sourceFilter !== 'all' && question.source !== sourceFilter) {
                    return false;
                }
                
                // تصفية حسب الامتحان/الفصل
                if (examChapterFilter !== 'all' && question.examId !== examChapterFilter) {
                    return false;
                }
                
                return true;
            });
            
            displayQuestions();
            updateStats();
        }

        // عرض الأسئلة
        function displayQuestions() {
            const container = document.getElementById('questionsContainer');
            
            if (filteredQuestions.length === 0) {
                container.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-search"></i>
                        <p>لا توجد أسئلة تطابق معايير التصفية المحددة</p>
                    </div>
                `;
                return;
            }
            
            // تجميع الأسئلة حسب الامتحان/الفصل
            const questionsByExam = {};
            filteredQuestions.forEach(question => {
                if (!questionsByExam[question.examId]) {
                    questionsByExam[question.examId] = {
                        examNameAr: question.examNameAr,
                        examNameEn: question.examNameEn,
                        trueFalse: [],
                        essay: []
                    };
                }
                
                if (question.type === 'true_false') {
                    questionsByExam[question.examId].trueFalse.push(question);
                } else {
                    questionsByExam[question.examId].essay.push(question);
                }
            });
            
            // بناء HTML لعرض الأسئلة
            let html = '';
            
            for (const examId in questionsByExam) {
                const exam = questionsByExam[examId];
                
                html += `
                    <div class="exam-section">
                        <div class="exam-header">
                            <div class="exam-title">
                                <h2>
                                    <i class="fas fa-file-alt"></i>
                                    <span>${currentLanguage === 'ar' ? exam.examNameAr : exam.examNameEn}</span>
                                </h2>
                            </div>
                            <div class="exam-meta">
                                <span>
                                    <i class="fas fa-list-ol"></i>
                                    <span>${exam.trueFalse.length + exam.essay.length} سؤال</span>
                                </span>
                            </div>
                        </div>
                `;
                
                // عرض أسئلة صح/خطأ
                if (exam.trueFalse.length > 0) {
                    html += `
                        <h3 class="question-type">
                            <i class="fas fa-check-circle"></i>
                            <span>أسئلة صح/خطأ</span>
                        </h3>
                    `;
                    
                    exam.trueFalse.forEach(question => {
                        html += createQuestionCard(question);
                    });
                }
                
                // عرض أسئلة مقالية
                if (exam.essay.length > 0) {
                    html += `
                        <h3 class="question-type">
                            <i class="fas fa-edit"></i>
                            <span>أسئلة مقالية</span>
                        </h3>
                    `;
                    
                    exam.essay.forEach(question => {
                        html += createQuestionCard(question);
                    });
                }
                
                html += `</div>`;
            }
            
            container.innerHTML = html;
            
            // تطبيق وضع العرض الحالي
            applyViewMode();
            
            // إضافة مستمعي الأحداث للأزرار الديناميكية
            document.querySelectorAll('.correction-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const questionId = this.getAttribute('data-question-id');
                    toggleCorrection(questionId);
                });
            });
            
            document.querySelectorAll('.reference-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const questionId = this.getAttribute('data-question-id');
                    toggleReference(questionId);
                });
            });
            
            // عرض التصحيحات إذا كان showAllCorrections مفعلاً
            if (showAllCorrections) {
                document.querySelectorAll('.correction-section').forEach(section => {
                    section.classList.add('show');
                });
            }
            
            // عرض المراجع إذا كان showAllReferences مفعلاً
            if (showAllReferences) {
                document.querySelectorAll('.reference-section').forEach(section => {
                    section.classList.add('show');
                });
            }
        }

        // إنشاء بطاقة سؤال
        function createQuestionCard(question) {
            let answerIndicator = '';
            let answerClass = '';
            
            if (question.type === 'true_false') {
                if (question.answerBoolean) {
                    answerIndicator = currentLanguage === 'ar' ? question.answerAr : question.answerEn;
                    answerClass = 'answer-true';
                } else {
                    answerIndicator = currentLanguage === 'ar' ? question.answerAr : question.answerEn;
                    answerClass = 'answer-false';
                }
            } else {
                answerIndicator = currentLanguage === 'ar' ? 'مقالي' : 'Essay';
                answerClass = 'answer-essay';
            }
            
            let html = `
                <div class="question-card ${question.type}">
                    <div class="question-header">
                        <div class="question-number">${question.number}</div>
                        <div class="question-text">
                            <div class="question-text-ar">${question.questionAr}</div>
                            <div class="question-text-en">${question.questionEn}</div>
                        </div>
                        <div class="answer-indicator ${answerClass}">${answerIndicator}</div>
                    </div>
                    
                    <div class="question-body">
            `;
            
            // لعرض إجابة أسئلة صح/خطأ
            if (question.type === 'true_false') {
                html += `
                    <div class="answer-section">
                        <h5>
                            <i class="fas fa-check"></i>
                            <span>الإجابة</span>
                        </h5>
                        <div class="answer-ar">${question.answerAr}</div>
                        <div class="answer-en">${question.answerEn}</div>
                    </div>
                `;
            }
            
            // قسم التصحيح (لأسئلة صح/خطأ)
            if (question.type === 'true_false' && (question.correctionAr || question.correctionEn)) {
                html += `
                    <div class="correction-section" id="correction-${question.id}">
                        <div class="correction-header">
                            <i class="fas fa-exclamation-circle"></i>
                            <span>تصحيح الخطأ</span>
                        </div>
                        <div class="correction-content">
                `;
                
                if (question.correctionAr) {
                    html += `<div class="correction-ar">${question.correctionAr}</div>`;
                }
                
                if (question.correctionEn) {
                    html += `<div class="correction-en">${question.correctionEn}</div>`;
                }
                
                html += `</div></div>`;
            }
            
            // قسم نقاط الإجابة (لأسئلة المقال)
            if (question.type === 'essay') {
                const answerPointsAr = question.answerPointsAr || [];
                const answerPointsEn = question.answerPointsEn || [];
                
                if (answerPointsAr.length > 0 || answerPointsEn.length > 0) {
                    html += `
                        <div class="essay-points">
                            <h5>
                                <i class="fas fa-list-check"></i>
                                <span>نقاط الإجابة</span>
                            </h5>
                    `;
                    
                    if (answerPointsAr.length > 0) {
                        html += `
                            <div class="points-ar">
                                <h6>
                                    <i class="fas fa-language"></i>
                                    <span>بالعربية</span>
                                </h6>
                                <ul>
                        `;
                        
                        answerPointsAr.forEach(point => {
                            html += `<li>${point}</li>`;
                        });
                        
                        html += `</ul></div>`;
                    }
                    
                    if (answerPointsEn.length > 0) {
                        html += `
                            <div class="points-en">
                                <h6>
                                    <i class="fas fa-language"></i>
                                    <span>بالإنجليزية</span>
                                </h6>
                                <ul>
                        `;
                        
                        answerPointsEn.forEach(point => {
                            html += `<li>${point}</li>`;
                        });
                        
                        html += `</ul></div>`;
                    }
                    
                    html += `</div>`;
                }
            }
            
            // قسم المرجع
            if (question.support && question.support.length > 0) {
                const support = question.support[0];
                html += `
                    <div class="reference-section" id="reference-${question.id}">
                        <i class="fas fa-book"></i>
                        <div class="reference-content">
                            <strong>المرجع: </strong>
                            ${support.file} - 
                            <span>الصفحة: </span>
                            ${support.page}
                        </div>
                    </div>
                `;
            }
            
            // أزرار التفاعل
            html += `<div class="question-actions">`;
            
            // زر عرض التصحيح (لأسئلة صح/خطأ التي تحتوي على تصحيح)
            if (question.type === 'true_false' && (question.correctionAr || question.correctionEn)) {
                html += `
                    <button class="action-btn correction-btn" data-question-id="${question.id}">
                        <i class="fas fa-lightbulb"></i>
                        <span>عرض التصحيح</span>
                    </button>
                `;
            }
            
            // زر عرض المرجع
            if (question.support && question.support.length > 0) {
                html += `
                    <button class="action-btn reference-btn" data-question-id="${question.id}">
                        <i class="fas fa-book"></i>
                        <span>عرض المرجع</span>
                    </button>
                `;
            }
            
            html += `</div></div></div>`;
            
            return html;
        }

        // تطبيق وضع العرض الحالي
        function applyViewMode() {
            const arabicElements = document.querySelectorAll('.question-text-ar, .answer-ar, .correction-ar, .points-ar');
            const englishElements = document.querySelectorAll('.question-text-en, .answer-en, .correction-en, .points-en');
            
            if (currentViewMode === 'arabic') {
                arabicElements.forEach(el => el.style.display = 'block');
                englishElements.forEach(el => el.style.display = 'none');
            } else if (currentViewMode === 'english') {
                arabicElements.forEach(el => el.style.display = 'none');
                englishElements.forEach(el => el.style.display = 'block');
            } else { // both
                arabicElements.forEach(el => el.style.display = 'block');
                englishElements.forEach(el => el.style.display = 'block');
            }
        }

        // تبديل التصحيح
        function toggleCorrection(questionId) {
            const correctionSection = document.getElementById(`correction-${questionId}`);
            if (correctionSection) {
                correctionSection.classList.toggle('show');
                
                // تحديث نص الزر
                const btn = document.querySelector(`.correction-btn[data-question-id="${questionId}"]`);
                if (btn) {
                    const isShowing = correctionSection.classList.contains('show');
                    const icon = btn.querySelector('i');
                    const text = btn.querySelector('span');
                    
                    if (isShowing) {
                        icon.className = 'fas fa-eye-slash';
                        text.textContent = 'إخفاء التصحيح';
                    } else {
                        icon.className = 'fas fa-lightbulb';
                        text.textContent = 'عرض التصحيح';
                    }
                }
            }
        }

        // تبديل المرجع
        function toggleReference(questionId) {
            const referenceSection = document.getElementById(`reference-${questionId}`);
            if (referenceSection) {
                referenceSection.classList.toggle('show');
                
                // تحديث نص الزر
                const btn = document.querySelector(`.reference-btn[data-question-id="${questionId}"]`);
                if (btn) {
                    const isShowing = referenceSection.classList.contains('show');
                    const icon = btn.querySelector('i');
                    const text = btn.querySelector('span');
                    
                    if (isShowing) {
                        icon.className = 'fas fa-eye-slash';
                        text.textContent = 'إخفاء المرجع';
                    } else {
                        icon.className = 'fas fa-book';
                        text.textContent = 'عرض المرجع';
                    }
                }
            }
        }

        // تبديل جميع التصحيحات
        function toggleAllCorrections() {
            showAllCorrections = !showAllCorrections;
            
            const correctionSections = document.querySelectorAll('.correction-section');
            const btnText = document.getElementById('toggleCorrectionsText');
            
            if (showAllCorrections) {
                correctionSections.forEach(section => {
                    section.classList.add('show');
                });
                btnText.textContent = 'إخفاء جميع التصحيحات';
            } else {
                correctionSections.forEach(section => {
                    section.classList.remove('show');
                });
                btnText.textContent = 'عرض جميع التصحيحات';
            }
            
            // تحديث أزرار التصحيح الفردية
            document.querySelectorAll('.correction-btn').forEach(btn => {
                const questionId = btn.getAttribute('data-question-id');
                const correctionSection = document.getElementById(`correction-${questionId}`);
                
                if (correctionSection) {
                    const icon = btn.querySelector('i');
                    const text = btn.querySelector('span');
                    
                    if (showAllCorrections) {
                        icon.className = 'fas fa-eye-slash';
                        text.textContent = 'إخفاء التصحيح';
                    } else {
                        icon.className = 'fas fa-lightbulb';
                        text.textContent = 'عرض التصحيح';
                    }
                }
            });
        }

        // تبديل جميع المراجع
        function toggleAllReferences() {
            showAllReferences = !showAllReferences;
            
            const referenceSections = document.querySelectorAll('.reference-section');
            const btnText = document.getElementById('toggleReferencesText');
            
            if (showAllReferences) {
                referenceSections.forEach(section => {
                    section.classList.add('show');
                });
                btnText.textContent = 'إخفاء جميع المراجع';
            } else {
                referenceSections.forEach(section => {
                    section.classList.remove('show');
                });
                btnText.textContent = 'عرض جميع المراجع';
            }
            
            // تحديث أزرار المرجع الفردية
            document.querySelectorAll('.reference-btn').forEach(btn => {
                const questionId = btn.getAttribute('data-question-id');
                const referenceSection = document.getElementById(`reference-${questionId}`);
                
                if (referenceSection) {
                    const icon = btn.querySelector('i');
                    const text = btn.querySelector('span');
                    
                    if (showAllReferences) {
                        icon.className = 'fas fa-eye-slash';
                        text.textContent = 'إخفاء المرجع';
                    } else {
                        icon.className = 'fas fa-book';
                        text.textContent = 'عرض المرجع';
                    }
                }
            });
        }

        // تبديل اللغة
        function switchLanguage(lang) {
            currentLanguage = lang;
            
            // تبديل أزرار اللغة
            document.getElementById('arabicBtn').classList.toggle('active', lang === 'ar');
            document.getElementById('englishBtn').classList.toggle('active', lang === 'en');
            
            // تبديل اتجاه الصفحة
            document.body.dir = lang === 'ar' ? 'rtl' : 'ltr';
            
            // تحديث النصوص حسب اللغة
            updateTextsByLanguage();
            
            // تحديث قائمة التصفية
            updateExamChapterFilter();
            
            // إعادة عرض الأسئلة
            displayQuestions();
        }

        // تحديث النصوص حسب اللغة
        function updateTextsByLanguage() {
            const texts = {
                ar: {
                    filterTitle: 'تصفية الأسئلة',
                    questionTypeLabel: 'نوع السؤال',
                    sourceLabel: 'المصدر',
                    examChapterLabel: 'الامتحان / الفصل',
                    viewModeLabel: 'طريقة العرض:',
                    viewBothText: 'العربية والإنجليزية',
                    viewArabicText: 'العربية فقط',
                    viewEnglishText: 'الإنجليزية فقط',
                    totalQuestionsLabel: 'إجمالي الأسئلة',
                    tfQuestionsLabel: 'أسئلة صح/خطأ',
                    essayQuestionsLabel: 'أسئلة مقالية',
                    correctionQuestionsLabel: 'أسئلة تحتوي على تصحيح',
                    toggleCorrectionsText: showAllCorrections ? 'إخفاء جميع التصحيحات' : 'عرض جميع التصحيحات',
                    toggleReferencesText: showAllReferences ? 'إخفاء جميع المراجع' : 'عرض جميع المراجع',
                    footerText: 'بنك أسئلة لمادة معمارية الحاسوب - تم إنشاؤه بناءً على الشبترات من CH1 الى CH5 ',
                    copyrightText: 'جميع الحقوق محفوظة للمهندس عبدالملك حسان الحاج ©'
                },
                en: {
                    filterTitle: 'Filter Questions',
                    questionTypeLabel: 'Question Type',
                    sourceLabel: 'Source',
                    examChapterLabel: 'Exam / Chapter',
                    viewModeLabel: 'View Mode:',
                    viewBothText: 'Arabic and English',
                    viewArabicText: 'Arabic Only',
                    viewEnglishText: 'English Only',
                    totalQuestionsLabel: 'Total Questions',
                    tfQuestionsLabel: 'True/False Questions',
                    essayQuestionsLabel: 'Essay Questions',
                    correctionQuestionsLabel: 'Questions with Corrections',
                    toggleCorrectionsText: showAllCorrections ? 'Hide All Corrections' : 'Show All Corrections',
                    toggleReferencesText: showAllReferences ? 'Hide All References' : 'Show All References',
                    footerText: 'Computer Architecture Question Bank - Created based on Dr. Manal Al-Ariqi\'s course materials',
                    copyrightText: 'All rights reserved ©'
                }
            };
            
            const langTexts = texts[currentLanguage];
            
            // تحديث جميع النصوص
            for (const [key, value] of Object.entries(langTexts)) {
                const element = document.getElementById(key);
                if (element) {
                    element.textContent = value;
                }
            }
        }

        // تحديث الإحصائيات
        function updateStats() {
            const totalQuestions = filteredQuestions.length;
            const tfQuestions = filteredQuestions.filter(q => q.type === 'true_false').length;
            const essayQuestions = filteredQuestions.filter(q => q.type === 'essay').length;
            const correctionQuestions = filteredQuestions.filter(q => q.hasCorrection).length;
            
            document.getElementById('totalQuestions').textContent = totalQuestions;
            document.getElementById('tfQuestions').textContent = tfQuestions;
            document.getElementById('essayQuestions').textContent = essayQuestions;
            document.getElementById('correctionQuestions').textContent = correctionQuestions;
        }

        // تعيين وضع العرض
        function setViewMode(mode) {
            currentViewMode = mode;
            
            // تحديث أزرار العرض
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.querySelectorAll('.view-btn')[mode === 'both' ? 0 : mode === 'arabic' ? 1 : 2].classList.add('active');
            
            // تطبيق وضع العرض
            applyViewMode();
        }
    </script>
</body>

</html>
